<!doctype html>
<html lang="fr">
  <head>
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://fonts.googleapis.com; img-src 'self' data:; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com; connect-src 'self';"
    />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, maximum-scale=5.0" />
    <meta
      name="description"
      content="SubPilot - Gestionnaire intelligent d'abonnements pour suivre et optimiser vos dépenses récurrentes"
    />
    <meta name="theme-color" content="#6366f1" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="SubPilot" />

    <title>SubPilot - Gestionnaire d'abonnements</title>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="context-menu.css" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
  </head>
  <body>
    <div class="app-container">
      <!-- Sidebar -->
      <nav class="sidebar">
        <div class="sidebar-header" style="display: flex; flex-direction: column; align-items: flex-start; gap: 0.3em">
          <h1 style="margin-bottom: 0"><i class="fas fa-rocket"></i> SubPilot</h1>
          <button class="btn btn-primary" id="add-abonnement-btn" style="margin-top: 0.7em; width: 100%; display: flex; align-items: center; justify-content: center; gap: 0.5em;">
            <i class="fas fa-plus"></i> Nouvel abonnement
          </button>
        </div>
        <ul class="sidebar-menu">
          <li class="menu-item active" data-section="dashboard">
            <i class="fas fa-tachometer-alt"></i>
            <span>Tableau de bord</span>
          </li>
          <li class="menu-item" data-section="abonnements">
            <i class="fas fa-credit-card"></i>
            <span>Abonnements</span>
          </li>
          <li class="menu-item" data-section="corbeille">
            <i class="fas fa-trash"></i>
            <span>Corbeille</span>
          </li>
          <li class="menu-item" data-section="settings">
            <i class="fas fa-cog"></i>
            <span>Paramètres</span>
          </li>
        </ul>
        <div
          id="sidebar-version"
          style="
            position: absolute;
            left: 0;
            bottom: 18px;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
          "
        >
          <!-- Version dynamique JS -->
        </div>
      </nav>

      <!-- Main Content -->
      <main class="main-content">
        <header class="content-header">
          <h2 id="page-title">Tableau de bord</h2>
          <div class="header-actions"></div>
        </header>

        <!-- Dashboard Section -->
        <section id="dashboard-section" class="content-section active">
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-icon">
                <i class="fas fa-list-ol"></i>
              </div>
              <div class="stat-content">
                <h3 id="total-abonnements">0</h3>
                <p>Total abonnements</p>
                <div style="display: flex; gap: 1.5rem; justify-content: center; margin-top: 0.5rem">
                  <span style="color: #22c55e"
                    ><i class="fas fa-user-check"></i> <span id="total-actifs">0</span> actifs</span
                  >
                  <span style="color: #ef4444"
                    ><i class="fas fa-user-slash"></i> <span id="total-inactifs">0</span> inactifs</span
                  >
                  <span style="color: #6366f1"
                    ><i class="fas fa-trash"></i> <span id="total-corbeille-mini">0</span> corbeille</span
                  >
                </div>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">
                <i class="fas fa-euro-sign"></i>
              </div>

              <div class="stat-content" style="display: flex; flex-direction: column; gap: 0.5em">
                <div
                  style="
                    background: #e0f7fa;
                    border-radius: 8px;
                    padding: 0.5em 0.8em;
                    display: flex;
                    flex-direction: column;
                    gap: 0.2em;
                    font-weight: 600;
                    font-size: 1.15em;
                    color: #0288d1;
                  "
                >
                  <span style="display: flex; align-items: center; gap: 0.5em"
                    ><i class="fas fa-calendar-day"></i> Mensuel : <span id="cout-mensuel">0,00 €</span></span
                  >
                  <span style="font-size: 0.95em; color: #0891b2; font-weight: 400; margin-left: 2em"
                    >dont <span id="val-mensuel">0,00 €</span> mensuel</span
                  >
                </div>
                <div
                  style="
                    background: #f3e8ff;
                    border-radius: 8px;
                    padding: 0.5em 0.8em;
                    display: flex;
                    flex-direction: column;
                    gap: 0.2em;
                    font-size: 1em;
                    color: #7c3aed;
                  "
                >
                  <span style="display: flex; align-items: center; gap: 0.5em"
                    ><i class="fas fa-calendar-alt"></i> Annuel : <span id="cout-annuel">0,00 €</span></span
                  >
                  <span style="font-size: 0.95em; color: #a21caf; font-weight: 400; margin-left: 2em"
                    >dont <span id="val-annuel">0,00 €</span> annuel</span
                  >
                </div>
              </div>
            </div>
            <!-- fin .stat-card -->
          </div>
          <!-- fin .stats-grid -->
        </section>

        <!-- Corbeille Section -->
        <section id="corbeille-section" class="content-section">
          <div class="corbeille-section">
            <div id="corbeille-abonnements" class="abonnements-grid"></div>
          </div>
        </section>

        <!-- Abonnements Section -->
        <section id="abonnements-section" class="content-section">
          <div class="abonnements-header" style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1.5em;"></div>
          <div id="abonnements-list" class="abonnements-grid">
            <!-- Les abonnements seront affichés ici -->
          </div>
        </section>

        <!-- Paramètres Section -->
        <section id="settings-section" class="content-section">
          <!-- Zone de gestion de la clé API Gemini -->
          <div class="settings-panel settings-api-panel">
            <h3 class="settings-panel-title">Clé API Gemini</h3>
            <input id="gemini-api-key" type="text" placeholder="Collez votre clé API Gemini ici" class="settings-input" />
            <button class="btn btn-primary" id="save-gemini-key" style="margin-top: 0.2em; align-self: flex-end; min-width: 120px; font-size: 1.08em;">Enregistrer</button>
          </div>
          <!-- Système de thème sombre/clair -->
          <div class="settings-panel settings-theme-panel">
            <h3 class="settings-panel-title">Thème</h3>
            <div class="theme-switch-row">
              <label class="theme-switch-label">
                <input type="radio" name="theme-mode" value="light" id="theme-light" />
                <i class="fas fa-sun theme-icon-sun"></i> Clair
              </label>
              <label class="theme-switch-label">
                <input type="radio" name="theme-mode" value="dark" id="theme-dark" />
                <i class="fas fa-moon theme-icon-moon"></i> Sombre
              </label>
            </div>
          </div>
          <!-- Zone suppression totale -->

        </section>

        <!-- Suppression de la section Corbeille -->

        <!-- Suppression de la section Catégories -->

        <!-- Suppression de la section Statistiques -->
      </main>
    </div>

    <!-- Modal Abonnement -->
    <div id="abonnement-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="modal-title">Nouvel abonnement</h3>
        </div>
        <form id="abonnement-form" class="modal-form" style="font-size: 0.95em;">
          <div class="form-group">
            <label for="nom">Nom du service *</label>
            <input type="text" id="nom" name="nom" required style="font-size: 0.95em;" />
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="prix">Prix *</label>
              <input type="number" id="prix" name="prix" step="0.01" min="-999999" required style="font-size: 0.95em;" />
            </div>
            <div class="form-group">
              <label for="promo-val">Promotion</label>
              <div style="display: flex; gap: 0.5em; align-items: center;">
                <input type="number" id="promo-val" name="promo-val" step="0.01" min="0" placeholder="0" style="width: 80px; font-size: 0.95em;" />
                <select id="promo-type" name="promo-type" style="width: 60px; font-size: 0.95em;">
                  <option value="%">%</option>
                  <option value="€">€</option>
                </select>
              </div>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="frequence">Fréquence *</label>
              <select id="frequence" name="frequence" required>
                <option value="mensuel">Mensuel</option>
              </select>
            </div>
            <!-- Suppression du champ catégorie -->
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="date_debut">Date de début *</label>
              <input type="date" id="date_debut" name="date_debut" required />
            </div>
          </div>

          <!-- Champs site web et description supprimés -->

          <div class="form-actions">
            <button type="button" class="btn btn-secondary" id="cancel-abonnement">Annuler</button>
            <button type="submit" class="btn btn-primary">Enregistrer</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Suppression du modal catégorie -->

    <!-- Notification Container -->
    <div id="notification-container" class="notification-container"></div>

    <script src="app.js"></script>
  </body>
</html>
